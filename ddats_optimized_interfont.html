<!DOCTYPE html>
<html lang="nl" id="html-root">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>D-DATS Calculator</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}
.container{max-width:600px;margin:0 auto;background:white;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);overflow:hidden}
.header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:30px;text-align:center;position:relative}
.language-toggle{position:absolute;top:15px;right:15px;display:flex;gap:5px}
.lang-btn{width:30px;height:20px;border:2px solid rgba(255,255,255,0.3);border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:bold;color:rgba(255,255,255,0.7);transition:all 0.3s ease}
.lang-btn.active{border-color:white;color:white;background:rgba(255,255,255,0.2)}
.logo-container{width:80px;height:80px;margin:0 auto 15px;background:white;border-radius:50%;display:flex;align-items:center;justify-content:center}
.logo-svg{width:60px;height:60px}
h1{font-size:28px;margin-bottom:5px}
.subtitle{font-size:14px;opacity:0.9}
.validation-info{font-size:12px;margin-top:10px;opacity:0.8}
.content{padding:20px}
.section{margin-bottom:25px}
.expander{border:1px solid #e2e8f0;border-radius:12px;margin-bottom:15px;overflow:hidden;transition:all 0.3s ease}
.expander.expanded{box-shadow:0 4px 12px rgba(0,0,0,0.1)}
.expander-header{padding:15px 20px;background:#f8fafc;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:background 0.3s ease}
.expander-header:hover{background:#f1f5f9}
.expander-title{font-weight:600;font-size:16px;color:#1e293b}
.expander-icon{transition:transform 0.3s ease;color:#64748b}
.expander.expanded .expander-icon{transform:rotate(180deg)}
.expander-content{max-height:0;overflow:hidden;transition:max-height 0.3s ease;padding:0 20px}
.expander.expanded .expander-content{max-height:2000px;padding:20px}
.input-group{margin-bottom:20px}
.input-with-info{display:flex;align-items:center;gap:8px}
.info-button{width:20px;height:20px;border-radius:50%;background:#3b82f6;color:white;border:none;cursor:pointer;font-size:12px;font-weight:bold;display:flex;align-items:center;justify-content:center;position:relative}
.info-button:hover{background:#2563eb}
.tooltip{position:absolute;bottom:25px;left:50%;transform:translateX(-50%);background:#1f2937;color:white;padding:8px 12px;border-radius:6px;font-size:12px;opacity:0;pointer-events:none;transition:opacity 0.3s ease;z-index:1000;max-width:250px;white-space:normal}
.tooltip:before{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:5px solid transparent;border-top-color:#1f2937}
.info-button:hover .tooltip{opacity:1}
label{display:block;margin-bottom:8px;font-weight:500;color:#475569;font-size:14px}
input[type="number"]{width:100%;padding:12px;border:2px solid #e2e8f0;border-radius:8px;font-size:16px;transition:border-color 0.3s ease}
input[type="number"]:focus{outline:none;border-color:#667eea}
.radio-group{display:flex;gap:20px;margin-top:8px}
.radio-option{display:flex;align-items:center;cursor:pointer}
.radio-option input[type="radio"]{margin-right:8px;width:20px;height:20px;cursor:pointer}
.radio-option label{margin:0;cursor:pointer;font-size:16px}
.score-display{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:30px;border-radius:16px;text-align:center;margin:20px 0}
.score-value{font-size:48px;font-weight:bold;margin-bottom:10px}
.score-label{font-size:18px;opacity:0.9}
.interpretation{padding:20px;border-radius:12px;margin:20px 0}
.interpretation.positive{background:#dcfce7;border-left:4px solid #22c55e;color:#166534}
.interpretation.negative{background:#dbeafe;border-left:4px solid #3b82f6;color:#1e40af}
.medication-item{background:#f8fafc;padding:15px;border-radius:8px;margin-bottom:10px}
.medication-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.medication-inputs{display:grid;grid-template-columns:2fr 1fr 1fr;gap:10px}
select{width:100%;padding:12px;border:2px solid #e2e8f0;border-radius:8px;font-size:14px;background:white;cursor:pointer}
select:focus{outline:none;border-color:#667eea}
.btn{padding:12px 24px;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s ease}
.btn-primary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(102,126,234,0.4)}
.btn-secondary{background:#f1f5f9;color:#475569}
.btn-secondary:hover{background:#e2e8f0}
.btn-danger{background:#fee2e2;color:#dc2626;padding:8px 12px;font-size:14px}
.btn-danger:hover{background:#fecaca}
.ledd-total{background:#f0f9ff;padding:15px;border-radius:8px;margin-top:15px;text-align:center;border:2px solid #0ea5e9}
.ledd-total-value{font-size:24px;font-weight:bold;color:#0369a1}
.export-area{background:#f8fafc;padding:15px;border-radius:8px;font-family:'Courier New',monospace;font-size:13px;white-space:pre-wrap;margin-bottom:15px;border:1px solid #e2e8f0;max-height:200px;overflow-y:auto}
.copy-success{color:#22c55e;font-size:14px;margin-top:10px;display:none}
@media (max-width:640px){.medication-inputs{grid-template-columns:1fr}.radio-group{flex-direction:column;gap:10px}}
</style>
</head>
<body>
<div class="container">
<div class="header">
<div class="language-toggle">
<div class="lang-btn active" onclick="setLanguage('nl')">NL</div>
<div class="lang-btn" onclick="setLanguage('en')">EN</div>
</div>
<div class="logo-container">
<svg class="logo-svg" viewBox="0 0 169.78 147.89">
<g>
<path fill="#1F3B75" d="M88.96,36.75c-14.2,24.47-47.48,81.77-49.9,85.94c-0.5,0.36-15.68-10.37-17.02-12.79c6.15-10.32,44.42-76.3,47.56-80.82C76.05,31.64,82.51,34.2,88.96,36.75z"/>
<path fill="#F9D3E6" d="M6.47,126.29c0-9.11,7.39-16.5,16.5-16.5s16.5,7.39,16.5,16.5s-7.39,16.5-16.5,16.5S6.47,135.41,6.47,126.29"/>
<path fill="#1F3B75" d="M130.67,132.64H47.19c-1.14,0-1.79-1.23-1.23-2.22c0-0.01,0.01-0.01,0.01-0.02c2.82-5.14,5.78-10.21,8.47-15.41c1.08-2.09,2.31-2.86,4.74-2.85c26.95,0.11,53.9,0.09,80.86,0.1c1.04,0,1.74,1.06,1.34,2.02c-1.77,4.22-6.95,13.17-9.44,17.65C131.68,132.36,131.2,132.64,130.67,132.64z"/>
<path fill="#1F3B75" d="M141.3,103.06c-8.01,0-15.31-0.03-22.61,0.03c-1.28,0.01-1.8-0.71-2.33-1.64c-8.75-15.39-17.51-30.78-26.31-46.15c-0.64-1.12-0.75-1.92,0.14-3.01c4.19-5.08,8.29-10.24,12.84-15.89C115.83,58.67,128.41,80.6,141.3,103.06z"/>
<path fill="#D8EEF6" d="M84.32,5.09c9.11,0,16.5,7.39,16.5,16.5s-7.39,16.5-16.5,16.5s-16.5-7.39-16.5-16.5S75.21,5.09,84.32,5.09"/>
<circle fill="#BAD9A8" cx="146.81" cy="126.29" r="16.5"/>
</g>
</svg>
</div>
<h1 class="text-title">D-DATS Calculator</h1>
<div class="subtitle text-subtitle">Dutch Device-Aided Therapy Screening Tool</div>
<div class="validation-info text-validation">Externe validatie: AUROC 0.93 • Cutoff: 5.8</div>
</div>
<div class="content">
<div class="section">
<div class="expander expanded" id="main-calc">
<div class="expander-header" onclick="toggleExpander('main-calc')">
<span class="expander-title">
<svg style="width:20px;height:20px;margin-right:8px;vertical-align:middle" viewBox="0 0 169.78 147.89">
<path fill="#1F3B75" d="M88.96,36.75c-14.2,24.47-47.48,81.77-49.9,85.94c-0.5,0.36-15.68-10.37-17.02-12.79c6.15-10.32,44.42-76.3,47.56-80.82C76.05,31.64,82.51,34.2,88.96,36.75z"/>
<circle fill="#F9D3E6" cx="22.97" cy="126.29" r="16.5"/>
<path fill="#1F3B75" d="M130.67,132.64H47.19c-1.14,0-1.79-1.23-1.23-2.22c0-0.01,0.01-0.01,0.01-0.02c2.82-5.14,5.78-10.21,8.47-15.41c1.08-2.09,2.31-2.86,4.74-2.85c26.95,0.11,53.9,0.09,80.86,0.1c1.04,0,1.74,1.06,1.34,2.02c-1.77,4.22-6.95,13.17-9.44,17.65C131.68,132.36,131.2,132.64,130.67,132.64z"/>
<path fill="#1F3B75" d="M141.3,103.06c-8.01,0-15.31-0.03-22.61,0.03c-1.28,0.01-1.8-0.71-2.33-1.64c-8.75-15.39-17.51-30.78-26.31-46.15c-0.64-1.12-0.75-1.92,0.14-3.01c4.19-5.08,8.29-10.24,12.84-15.89C115.83,58.67,128.41,80.6,141.3,103.06z"/>
<circle fill="#D8EEF6" cx="84.32" cy="21.59" r="16.5"/>
<circle fill="#BAD9A8" cx="146.81" cy="126.29" r="16.5"/>
</svg>
<span class="text-main-calculation">D-DATS Berekening</span>
</span>
<span class="expander-icon">▼</span>
</div>
<div class="expander-content">
<div class="input-group">
<label for="ledd-input" class="text-ledd-label">LEDD (mg/dag)</label>
<input type="number" id="ledd-input" min="0" max="3000" step="50" value="0" onchange="calculateDDATS()">
<div style="margin-top:10px">
<button class="btn btn-secondary" onclick="useLEDDFromCalculator()" style="width:100%">
<span class="text-use-ledd">Gebruik LEDD van calculator hieronder</span>
</button>
</div>
</div>
<div class="input-group">
<div class="input-with-info">
<label class="text-fluctuations-label">Responsfluctuaties aanwezig?</label>
<button class="info-button">?
<div class="tooltip text-fluctuations-tooltip">Responsfluctuaties zijn on/off perioden, predictable/unpredictable wearing-off, delayed-on, no-on, dose failures</div>
</button>
</div>
<div class="radio-group">
<div class="radio-option">
<input type="radio" id="fluct-no" name="fluctuations" value="no" checked onchange="calculateDDATS()">
<label for="fluct-no" class="text-no">Nee</label>
</div>
<div class="radio-option">
<input type="radio" id="fluct-yes" name="fluctuations" value="yes" onchange="calculateDDATS()">
<label for="fluct-yes" class="text-yes">Ja</label>
</div>
</div>
</div>
<div class="input-group">
<div class="input-with-info">
<label class="text-dyskinesias-label">Hinderlijke dyskinesieën aanwezig?</label>
<button class="info-button">?
<div class="tooltip text-dyskinesias-tooltip">Hinderlijke dyskinesieën zijn onwillekeurige bewegingen die de patiënt hinderen in dagelijkse activiteiten of sociale situaties</div>
</button>
</div>
<div class="radio-group">
<div class="radio-option">
<input type="radio" id="dysk-no" name="dyskinesias" value="no" checked onchange="calculateDDATS()">
<label for="dysk-no" class="text-no">Nee</label>
</div>
<div class="radio-option">
<input type="radio" id="dysk-yes" name="dyskinesias" value="yes" onchange="calculateDDATS()">
<label for="dysk-yes" class="text-yes">Ja</label>
</div>
</div>
</div>
<div class="score-display">
<div class="score-value" id="ddats-score">0.00</div>
<div class="score-label">D-DATS Score</div>
</div>
<div class="interpretation negative" id="interpretation">
<strong class="text-score-below">Score <5.8</strong><br>
<span class="text-no-dat-indication">Geen directe indicatie voor DAT-verwijzing</span>
</div>
</div>
</div>
</div>
<div class="section">
<div class="expander" id="ledd-calc">
<div class="expander-header" onclick="toggleExpander('ledd-calc')">
<span class="expander-title">💊 <span class="text-ledd-calculator">LEDD Calculator</span></span>
<span class="expander-icon">▼</span>
</div>
<div class="expander-content">
<div id="medications-list"></div>
<button class="btn btn-primary" onclick="addMedication()" style="width:100%;margin-top:10px">
<span class="text-add-medication">+ Medicatie toevoegen</span>
</button>
<div class="ledd-total">
<div class="text-total-ledd">Totale LEDD</div>
<div class="ledd-total-value" id="total-ledd">0 mg/dag</div>
</div>
</div>
</div>
</div>
<div class="section">
<div class="expander" id="advanced">
<div class="expander-header" onclick="toggleExpander('advanced')">
<span class="expander-title">📊 <span class="text-advanced-display">Geavanceerde weergave</span></span>
<span class="expander-icon">▼</span>
</div>
<div class="expander-content">
<h3 style="margin-top:20px;margin-bottom:10px" class="text-score-breakdown">Score Breakdown</h3>
<table style="width:100%;border-collapse:collapse">
<tr style="background:#f8fafc">
<td style="padding:10px;border:1px solid #e2e8f0" class="text-ledd-component">LEDD component</td>
<td style="padding:10px;border:1px solid #e2e8f0;text-align:right" id="ledd-component">0.00</td>
</tr>
<tr>
<td style="padding:10px;border:1px solid #e2e8f0" class="text-fluctuations-component">Responsfluctuaties</td>
<td style="padding:10px;border:1px solid #e2e8f0;text-align:right" id="fluct-component">0.00</td>
</tr>
<tr style="background:#f8fafc">
<td style="padding:10px;border:1px solid #e2e8f0" class="text-dyskinesias-component">Hinderlijke dyskinesieën</td>
<td style="padding:10px;border:1px solid #e2e8f0;text-align:right" id="dysk-component">0.00</td>
</tr>
<tr style="background:#e0e7ff">
<td style="padding:10px;border:1px solid #e2e8f0;font-weight:bold" class="text-total-component">Totaal</td>
<td style="padding:10px;border:1px solid #e2e8f0;text-align:right;font-weight:bold" id="total-component">0.00</td>
</tr>
</table>
</div>
</div>
</div>
<div class="section">
<div class="expander" id="export">
<div class="expander-header" onclick="toggleExpander('export')">
<span class="expander-title">📋 <span class="text-export-epd">Export naar EPD</span></span>
<span class="expander-icon">▼</span>
</div>
<div class="expander-content">
<div class="export-area" id="export-text"></div>
<button class="btn btn-primary" onclick="copyToClipboard()" style="width:100%">
<span class="text-copy-clipboard">Kopieer naar klembord</span>
</button>
<div class="copy-success" id="copy-success">
<span class="text-copied">✓ Gekopieerd naar klembord!</span>
</div>
</div>
</div>
</div>
</div>
</div>
<script>
// Automatische taaldetectie gebaseerd op browser
function detectLanguage() {
    const browserLang = navigator.language || navigator.userLanguage;
    return browserLang.startsWith('nl') ? 'nl' : 'en';
}

let currentLanguage = detectLanguage(); // Detecteer automatisch, fallback naar EN
const translations={'nl':{'text-title':'D-DATS Calculator','text-subtitle':'Dutch Device-Aided Therapy Screening Tool','text-validation':'Externe validatie: AUROC 0.93 • Cutoff: 5.8','text-main-calculation':'D-DATS Berekening','text-ledd-label':'LEDD (mg/dag)','text-use-ledd':'Gebruik LEDD van calculator hieronder','text-fluctuations-label':'Responsfluctuaties aanwezig?','text-fluctuations-tooltip':'Responsfluctuaties zijn on/off perioden, predictable/unpredictable wearing-off, delayed-on, no-on, dose failures','text-dyskinesias-label':'Hinderlijke dyskinesieën aanwezig?','text-dyskinesias-tooltip':'Hinderlijke dyskinesieën zijn onwillekeurige bewegingen die de patiënt hinderen in dagelijkse activiteiten of sociale situaties','text-yes':'Ja','text-no':'Nee','text-score-below':'Score <5.8','text-no-dat-indication':'Geen directe indicatie voor DAT-verwijzing','text-score-above':'Score ≥5.8','text-dat-consideration':'Overweeg verwijzing voor DAT evaluatie','text-ledd-calculator':'LEDD Calculator','text-add-medication':'+ Medicatie toevoegen','text-total-ledd':'Totale LEDD','text-advanced-display':'Geavanceerde weergave','text-score-breakdown':'Score Breakdown','text-ledd-component':'LEDD component','text-fluctuations-component':'Responsfluctuaties','text-dyskinesias-component':'Hinderlijke dyskinesieën','text-total-component':'Totaal','text-export-epd':'Export naar EPD','text-copy-clipboard':'Kopieer naar klembord','text-copied':'✓ Gekopieerd naar klembord!','text-medication':'Medicatie','text-remove':'Verwijder'},'en':{'text-title':'D-DATS Calculator','text-subtitle':'Dutch Device-Aided Therapy Screening Tool','text-validation':'External validation: AUROC 0.93 • Cutoff: 5.8','text-main-calculation':'D-DATS Calculation','text-ledd-label':'LEDD (mg/day)','text-use-ledd':'Use LEDD from calculator below','text-fluctuations-label':'Response fluctuations present?','text-fluctuations-tooltip':'Response fluctuations are on/off periods, predictable/unpredictable wearing-off, delayed-on, no-on, dose failures','text-dyskinesias-label':'Troublesome dyskinesias present?','text-dyskinesias-tooltip':'Troublesome dyskinesias are involuntary movements that interfere with daily activities or social situations','text-yes':'Yes','text-no':'No','text-score-below':'Score <5.8','text-no-dat-indication':'No direct indication for DAT referral','text-score-above':'Score ≥5.8','text-dat-consideration':'Consider referral for DAT evaluation','text-ledd-calculator':'LEDD Calculator','text-add-medication':'+ Add medication','text-total-ledd':'Total LEDD','text-advanced-display':'Advanced display','text-score-breakdown':'Score Breakdown','text-ledd-component':'LEDD component','text-fluctuations-component':'Response fluctuations','text-dyskinesias-component':'Troublesome dyskinesias','text-total-component':'Total','text-export-epd':'Export to EHR','text-copy-clipboard':'Copy to clipboard','text-copied':'✓ Copied to clipboard!','text-medication':'Medication','text-remove':'Remove'}};
const MEDICATIONS={'levodopa':{name:{nl:'Levodopa/Carbidopa',en:'Levodopa/Carbidopa'},factor:1.0,unit:'mg',defaultDose:100},'levodopa_retard':{name:{nl:'Levodopa Retard',en:'Levodopa Retard'},factor:0.75,unit:'mg',defaultDose:100},'levodopa_entacapone':{name:{nl:'Levodopa/Carbidopa/Entacapone',en:'Levodopa/Carbidopa/Entacapone'},factor:1.33,unit:'mg',defaultDose:100},'pramipexol':{name:{nl:'Pramipexol',en:'Pramipexole'},factor:100.0,unit:'mg',defaultDose:1.05},'pramipexol_salt':{name:{nl:'Pramipexol (zout)',en:'Pramipexole (salt)'},factor:67.0,unit:'mg',defaultDose:1.57},'ropinirol':{name:{nl:'Ropinirol',en:'Ropinirole'},factor:20.0,unit:'mg',defaultDose:2.0},'rotigotine':{name:{nl:'Rotigotine',en:'Rotigotine'},factor:30.0,unit:'mg',defaultDose:6.0},'bromocriptine':{name:{nl:'Bromocriptine',en:'Bromocriptine'},factor:10.0,unit:'mg',defaultDose:15.0},'cabergoline':{name:{nl:'Cabergoline',en:'Cabergoline'},factor:50.0,unit:'mg',defaultDose:2.0},'selegiline':{name:{nl:'Selegiline',en:'Selegiline'},factor:10.0,unit:'mg',defaultDose:10.0},'rasagiline':{name:{nl:'Rasagiline',en:'Rasagiline'},factor:100.0,unit:'mg',defaultDose:1.0},'amantadine':{name:{nl:'Amantadine',en:'Amantadine'},factor:1.0,unit:'mg',defaultDose:200.0}};
const COMT_FACTORS={'none':1.0,'entacapone':1.33,'tolcapone':1.5,'opicapone':1.5};
let medications=[];
let medicationCounter=0;
        function setLanguage(lang){currentLanguage=lang;document.querySelectorAll('.lang-btn').forEach(btn=>{btn.classList.remove('active')});event.target.classList.add('active');Object.keys(translations[lang]).forEach(key=>{const elements=document.querySelectorAll('.'+key);elements.forEach(el=>{el.textContent=translations[lang][key]})});renderMedications();const ledd=parseFloat(document.getElementById('ledd-input').value)||0;const fluctuations=document.querySelector('input[name="fluctuations"]:checked').value==='yes';const dyskinesias=document.querySelector('input[name="dyskinesias"]:checked').value==='yes';const totalScore=calculateDDATSScore(ledd,fluctuations,dyskinesias);updateExportText(ledd,fluctuations,dyskinesias,totalScore);updateScoreDisplay(totalScore);const interpretation=document.getElementById('interpretation');if(totalScore>=5.8){interpretation.className='interpretation positive';interpretation.innerHTML=`<strong>${translations[currentLanguage]['text-score-above']}</strong><br>${translations[currentLanguage]['text-dat-consideration']}`}else{interpretation.className='interpretation negative';interpretation.innerHTML=`<strong>${translations[currentLanguage]['text-score-below']}</strong><br>${translations[currentLanguage]['text-no-dat-indication']}`}}

        function formatNumber(num, decimals = 2) {
            const fixed = num.toFixed(decimals);
            return currentLanguage === 'nl' ? fixed.replace('.', ',') : fixed;
        }

        function updateScoreDisplay(score) {
            document.getElementById('ddats-score').textContent = formatNumber(score);
            const ledd = parseFloat(document.getElementById('ledd-input').value) || 0;
            const fluctuations = document.querySelector('input[name="fluctuations"]:checked').value === 'yes';
            const dyskinesias = document.querySelector('input[name="dyskinesias"]:checked').value === 'yes';
            
            const leddComponent = ledd * 0.003;
            const fluctComponent = fluctuations ? 2.0 : 0;
            const dyskComponent = dyskinesias ? 2.0 : 0;
            
            document.getElementById('ledd-component').textContent = formatNumber(leddComponent);
            document.getElementById('fluct-component').textContent = formatNumber(fluctComponent);
            document.getElementById('dysk-component').textContent = formatNumber(dyskComponent);
            document.getElementById('total-component').textContent = formatNumber(score);
        }
function toggleExpander(id){const expander=document.getElementById(id);expander.classList.toggle('expanded')}
function calculateDDATSScore(ledd,fluctuations,dyskinesias){const leddComponent=ledd*0.003;const fluctComponent=fluctuations?2.0:0;const dyskComponent=dyskinesias?2.0:0;return leddComponent+fluctComponent+dyskComponent}
        function calculateDDATS(){const ledd=parseFloat(document.getElementById('ledd-input').value)||0;const fluctuations=document.querySelector('input[name="fluctuations"]:checked').value==='yes';const dyskinesias=document.querySelector('input[name="dyskinesias"]:checked').value==='yes';const totalScore=calculateDDATSScore(ledd,fluctuations,dyskinesias);const interpretation=document.getElementById('interpretation');if(totalScore>=5.8){interpretation.className='interpretation positive';interpretation.innerHTML=`<strong>${translations[currentLanguage]['text-score-above']}</strong><br>${translations[currentLanguage]['text-dat-consideration']}`}else{interpretation.className='interpretation negative';interpretation.innerHTML=`<strong>${translations[currentLanguage]['text-score-below']}</strong><br>${translations[currentLanguage]['text-no-dat-indication']}`}updateScoreDisplay(totalScore);updateExportText(ledd,fluctuations,dyskinesias,totalScore)}
function updateGauge(score){const needle=document.getElementById('gauge-needle');const angle=Math.min(Math.max(score/12*180-90,-90),90);needle.setAttribute('transform',`rotate(${angle} 100 100)`)}
function addMedication(){const id=medicationCounter++;medications.push({id:id,type:'levodopa',dose:MEDICATIONS['levodopa'].defaultDose,comt:'none'});renderMedications()}
function removeMedication(id){medications=medications.filter(m=>m.id!==id);renderMedications()}
        function renderMedications(){const container=document.getElementById('medications-list');container.innerHTML='';medications.forEach(med=>{const div=document.createElement('div');div.className='medication-item';const noCOMTText=currentLanguage==='nl'?'Geen COMT':'No COMT';div.innerHTML=`<div class="medication-header"><strong>${translations[currentLanguage]['text-medication']} ${medications.indexOf(med)+1}</strong><button class="btn btn-danger" onclick="removeMedication(${med.id})">${translations[currentLanguage]['text-remove']}</button></div><div class="medication-inputs"><select onchange="updateMedication(${med.id},'type',this.value)">${Object.entries(MEDICATIONS).map(([key,val])=>`<option value="${key}" ${med.type===key?'selected':''}>${val.name[currentLanguage]}</option>`).join('')}</select><input type="number" value="${med.dose}" min="0" step="0.25" onchange="updateMedication(${med.id},'dose',this.value)" placeholder="Dosis">${med.type.includes('levodopa')&&!med.type.includes('entacapone')?`<select onchange="updateMedication(${med.id},'comt',this.value)"><option value="none" ${med.comt==='none'?'selected':''}>${noCOMTText}</option><option value="entacapone" ${med.comt==='entacapone'?'selected':''}>+ Entacapone</option><option value="tolcapone" ${med.comt==='tolcapone'?'selected':''}>+ Tolcapone</option><option value="opicapone" ${med.comt==='opicapone'?'selected':''}>+ Opicapone</option></select>`:'<div></div>'}</div>`;container.appendChild(div)});calculateTotalLEDD()}
function updateMedication(id,field,value){const med=medications.find(m=>m.id===id);if(med){if(field==='dose'){med[field]=parseFloat(value)||0}else if(field==='type'){med[field]=value;med.dose=MEDICATIONS[value].defaultDose;if(!value.includes('levodopa')||value.includes('entacapone')){med.comt='none'}renderMedications();return}else{med[field]=value}calculateTotalLEDD()}}
        function calculateTotalLEDD(){let total=0;medications.forEach(med=>{const medInfo=MEDICATIONS[med.type];if(medInfo){let ledd=med.dose*medInfo.factor;if(med.type.includes('levodopa')&&!med.type.includes('entacapone')){ledd*=COMT_FACTORS[med.comt]}total+=ledd}});const dayText=currentLanguage==='nl'?'dag':'day';document.getElementById('total-ledd').textContent=`${Math.round(total)} mg/${dayText}`;return total}
function useLEDDFromCalculator(){const totalLEDD=calculateTotalLEDD();document.getElementById('ledd-input').value=Math.round(totalLEDD);calculateDDATS()}
function updateExportText(ledd,fluctuations,dyskinesias,score){const date=new Date().toLocaleDateString(currentLanguage==='nl'?'nl-NL':'en-US');const lang=currentLanguage;const yesNo=(val)=>val?translations[lang]['text-yes']:translations[lang]['text-no'];const interpretation=score>=5.8?translations[lang]['text-dat-consideration']:translations[lang]['text-no-dat-indication'];const text=`D-DATS ${lang==='nl'?'Berekening':'Calculation'} - ${date}
LEDD: ${ledd} mg/${lang==='nl'?'dag':'day'}
${translations[lang]['text-fluctuations-component']}: ${yesNo(fluctuations)}
${translations[lang]['text-dyskinesias-component']}: ${yesNo(dyskinesias)}
D-DATS Score: ${score.toFixed(2)}
${lang==='nl'?'Interpretatie':'Interpretation'}: ${score>=5.8?'Score ≥5.8 - ':'Score <5.8 - '}${interpretation}

${lang==='nl'?'Gebaseerd op gevalideerde D-DATS tool (AUROC 0.93, cutoff 5.8)':'Based on validated D-DATS tool (AUROC 0.93, cutoff 5.8)'}
${lang==='nl'?'Externe validatie: 164 patiënten, sensitiviteit 81%, specificiteit 92%':'External validation: 164 patients, sensitivity 81%, specificity 92%'}`;document.getElementById('export-text').textContent=text}
function copyToClipboard(){const text=document.getElementById('export-text').textContent;navigator.clipboard.writeText(text).then(()=>{const success=document.getElementById('copy-success');success.style.display='block';setTimeout(()=>{success.style.display='none'},3000)})}
calculateDDATS();
</script>
</body>
</html>